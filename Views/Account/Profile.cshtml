@using WebBanSach.Models.Entities
@using WebBanSach.Models.ViewModels;
@model UpdatePasswordViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = ViewBag.Customer as Customer;
    var passErr = TempData["PasswordError"] as string;
    var confirmErr = TempData["ConfirmError"] as string;
}

<section class="section-padding">
    <div class="container">
        <div class="row">
            <!-- Sidebar tab -->
            <div class="col-lg-3">
                <div class="card p-3 shadow-sm">
                <ul class="nav flex-column nav-pills" id="accountTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" role="tab">Tổng quan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="orders-tab" data-bs-toggle="pill" data-bs-target="#orders" role="tab">Đơn hàng</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="address-tab" data-bs-toggle="pill" data-bs-target="#address" role="tab">Địa chỉ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="details-tab" data-bs-toggle="pill" data-bs-target="#details" role="tab">Thông tin</a>
                    </li>
                    <li class="nav-item">
                        <a class ="nav-link" id="details-tab" data-bs-toggle="pill" data-bs-target="#password" role="tab">Đổi mật khẩu</a>
                    </li>
                </ul>
                </div>
            </div>

            <!-- Content tab -->
            <div class="col-lg-9">
                <div class="tab-content" id="accountTabContent">
                    <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                        <div class="card shadow-sm p-4">
                            <h5 class="mb-4">Chào mừng</h5>
                        <p>Xin chào <strong>@user.FullName</strong>!</p>
                        <p>Chào mừng bạn quay trở lại hệ thống quản lý đơn hàng của chúng tôi.</p>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="orders" role="tabpanel">
                        <div class="card shadow-sm p-4">
                            <h5 class="mb-4">Đơn hàng của bạn</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered align-middle">
                                    <thead class="table-light">
                                    <tr>
                                        <th>Mã đơn</th>
                                        <th>Ngày đặt</th>
                                        <th>Trạng thái</th>
                                        <th>Tổng tiền</th>
                                        <th>Số lượng sách</th>
                                        <th>Hành động</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in ViewBag.MyOrders as List<Order>)
                                    {
                                        <tr>
                                            <td><a class="account-order-id" href="#">#@order.OrderId</a></td>
                                            <td>@order.OrderDate?.ToString("dd/MM/yyyy")</td>
                                            <td>@order.Status?.StatusName</td>
                                            <td>@order.TotalPrice.ToString("#,##0") VNĐ</td>
                                            <td>@order.OrderItems.Sum(oi => oi.BookQuantity ?? 0) cuốn</td>
                                            <td>
                                                    <a asp-controller="Order" asp-action="Details" asp-route-id="@order.OrderId" class="btn btn-sm btn-outline-primary">
                                                    chi tiết
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="address" role="tabpanel">
                        <div class="card shadow-sm p-4">
                            <h5 class="mb-4">Địa chỉ</h5>
                            <p><strong>Địa chỉ giao hàng:</strong> @user.Address</p>
                            <br />
                            <form asp-action="UpdateAddress" method="post">
                                @Html.AntiForgeryToken()
                            <div class="row g-4">
                                <div class="col-lg-6">
                                    <input name="country" class="form-control" placeholder="Quốc gia" required />
                                </div>
                                <div class="col-lg-6">
                                    <input name="province" class="form-control" placeholder="Tỉnh/Thành phố" required />
                                </div>
                                <div class="col-lg-6">
                                    <input name="district" class="form-control" placeholder="Quận/Huyện" required />
                                </div>
                                <div class="col-lg-6">
                                    <input name="ward" class="form-control" placeholder="Phường/Xã" required />
                                </div>
                                <div class="col-lg-12">
                                    <input name="detail" class="form-control" placeholder="Số nhà, tên đường" required />
                                </div>
                            </div>
                            <button type="submit" class="theme-btn w-25 mt-4">Lưu địa chỉ</button>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="details" role="tabpanel">
                        <div class="card shadow-sm p-4">
                            <h5 class="mb-4">Thông tin cá nhân</h5>
                            <form asp-action="UpdateProfile" method="post">
                                @Html.AntiForgeryToken()
                                <div class="row g-4">
                                    <div class="col-lg-6">
                                        <label>Email</label>
                                        <input name="Email" class="form-control"  value="@user.Email" required />
                                    </div>
                                    <div class="col-lg-6">
                                        <label>Họ tên</label>
                                        <input name="FullName" class="form-control" value="@user.FullName" required />
                                    </div>
                                    <div class="col-lg-6">
                                        <label>Số điện thoại</label>
                                        <input name="Phone" class="form-control" value="@user.Phone" required />
                                    </div>
                                </div>
                                <button type="submit" class="theme-btn w-25 mt-4">Lưu thay đổi</button>
                            </form>
                        </div>
                    </div>
                    <!-- Đổi mật khẩu -->
                    <div class="tab-pane fade" id="password" role="tabpanel">
                        <div class="card shadow-sm p-4">
                            <h5 class="mb-4">Đổi mật khẩu</h5>
                            <form asp-action="UpdatePassword" method="post">
                                @Html.AntiForgeryToken()
                                <div class="mb-3">
                                    <label>Mật khẩu cũ</label>
                                    <input type="password" name="OldPassword" class="form-control" required />
                                </div>
                                <div class="mb-3">
                                    <label>Mật khẩu mới</label>
                                    <input type="password" name="NewPassword" class="form-control" required />
                                </div>
                                <div class="mb-3">
                                    <label>Xác nhận mật khẩu mới</label>
                                    <input type="password" name="ConfirmNewPassword" class="form-control" class="text-danger" required />
                                </div>
                                <button type="submit" class="theme-btn w-25 mt-4">Đổi mật khẩu</button>
                            </form>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</section>

